import{_ as pe}from"./head.vue_vue_type_script_setup_true_lang-CVHflgXU.js";import{g as G,n as _e,c as Z,G as he,k as ke,w as z,f as K,F as ye,_ as le,z as Ve,E as te,$ as J,Z as I,A}from"./index-D_D45AGk.js";import{C as oe}from"./index-DY8xNOIs.js";import{d as V,a as c,r as h,y as R,p as U,x as ne,X as B,Y as P,l as D,o as m,c as T,b as M,t as Y,F as L,j,w as y,k as H,_ as se,z as be,i as ge,C as xe,D as Ce,Z as we,A as Se,s as Te,f as De}from"./index-ChGP31iN.js";import{C as $e}from"./index-BV4Cb7xO.js";import{F as E}from"./index-87hGm5GN.js";import{L as Fe}from"./index-7fZ51QCR.js";import{B as O}from"./index-CaQXREIw.js";import"./index-Cg9P4DiM.js";import{P as ue,f as Me,g as Q,a as Be}from"./index-WodMhZLf.js";import{p as ie,P as re,s as Pe}from"./index-C0nNFawy.js";import"./index-Bfgpj5Js.js";import{u as ce}from"./use-id-BPTniptz.js";import{s as Ue,C as Ae}from"./index-CB-EYXyy.js";import{F as Ne}from"./index-ChSokyDm.js";import"./index-C6W4ofw4.js";import"./use-scope-id-D1EJU5AZ.js";import"./use-route-C2rTivEH.js";import"./on-popup-reopen-DEDEfK--.js";const[Ye,W]=Z("switch"),Ie={size:_e,loading:Boolean,disabled:Boolean,modelValue:G,activeColor:String,inactiveColor:String,activeValue:{type:G,default:!0},inactiveValue:{type:G,default:!1}};var Re=V({name:Ye,props:Ie,emits:["change","update:modelValue"],setup(e,{emit:t,slots:l}){const a=()=>e.modelValue===e.activeValue,s=()=>{if(!e.disabled&&!e.loading){const n=a()?e.inactiveValue:e.activeValue;t("update:modelValue",n),t("change",n)}},i=()=>{if(e.loading){const n=a()?e.activeColor:e.inactiveColor;return c(Fe,{class:W("loading"),color:n},null)}if(l.node)return l.node()};return he(()=>e.modelValue),()=>{var n;const{size:d,loading:f,disabled:b,activeColor:v,inactiveColor:x}=e,o=a(),_={fontSize:ke(d),backgroundColor:o?v:x};return c("div",{role:"switch",class:W({on:o,loading:f,disabled:b}),style:_,tabindex:b?void 0:0,"aria-checked":o,onClick:s},[c("div",{class:W("node")},[i()]),(n=l.background)==null?void 0:n.call(l)])}}});const Le=z(Re),je=z(Ue),me=K({},ie,{modelValue:ye(),filter:Function,formatter:{type:Function,default:(e,t)=>t}}),de=Object.keys(ie);function ze(e,t){if(e<0)return[];const l=Array(e);let a=-1;for(;++a<e;)l[a]=t(a);return l}const Ee=(e,t)=>32-new Date(e,t-1,32).getDate(),N=(e,t,l,a,s,i)=>{const n=ze(t-e+1,d=>{const f=le(e+d);return a(l,{text:f,value:f})});return s?s(l,n,i):n},ve=(e,t)=>e.map((l,a)=>{const s=t[a];if(s.length){const i=+s[0].value,n=+s[s.length-1].value;return le(Ve(+l,i,n))}return l}),ee=new Date().getFullYear(),[He]=Z("date-picker"),Oe=K({},me,{columnsType:{type:Array,default:()=>["year","month","day"]},minDate:{type:Date,default:()=>new Date(ee-10,0,1),validator:J},maxDate:{type:Date,default:()=>new Date(ee+10,11,31),validator:J}});var qe=V({name:He,props:Oe,emits:["confirm","cancel","change","update:modelValue"],setup(e,{emit:t,slots:l}){const a=h(e.modelValue),s=h(!1),i=h(),n=R(()=>s.value?e.modelValue:a.value),d=u=>u===e.minDate.getFullYear(),f=u=>u===e.maxDate.getFullYear(),b=u=>u===e.minDate.getMonth()+1,v=u=>u===e.maxDate.getMonth()+1,x=u=>{const{minDate:p,columnsType:C}=e,q=C.indexOf(u),X=n.value[q];if(X)return+X;switch(u){case"year":return p.getFullYear();case"month":return p.getMonth()+1;case"day":return p.getDate()}},o=()=>{const u=e.minDate.getFullYear(),p=e.maxDate.getFullYear();return N(u,p,"year",e.formatter,e.filter,n.value)},_=()=>{const u=x("year"),p=d(u)?e.minDate.getMonth()+1:1,C=f(u)?e.maxDate.getMonth()+1:12;return N(p,C,"month",e.formatter,e.filter,n.value)},g=()=>{const u=x("year"),p=x("month"),C=d(u)&&b(p)?e.minDate.getDate():1,q=f(u)&&v(p)?e.maxDate.getDate():Ee(u,p);return N(C,q,"day",e.formatter,e.filter,n.value)},w=()=>{var u;return(u=i.value)==null?void 0:u.confirm()},$=()=>a.value,F=R(()=>e.columnsType.map(u=>{switch(u){case"year":return o();case"month":return _();case"day":return g();default:return[]}}));U(a,u=>{I(u,e.modelValue)||t("update:modelValue",u)}),U(()=>e.modelValue,(u,p)=>{s.value=I(p,a.value),u=ve(u,F.value),I(u,a.value)||(a.value=u),s.value=!1},{immediate:!0});const r=(...u)=>t("change",...u),k=(...u)=>t("cancel",...u),S=(...u)=>t("confirm",...u);return ce({confirm:w,getSelectedDate:$}),()=>c(re,ne({ref:i,modelValue:a.value,"onUpdate:modelValue":u=>a.value=u,columns:F.value,onChange:r,onCancel:k,onConfirm:S},te(e,de)),l)}});const Ge=z(qe),We=z(Pe),[Ze]=Z("time-picker"),ae=e=>/^([01]\d|2[0-3]):([0-5]\d):([0-5]\d)$/.test(e),Ke=["hour","minute","second"],Xe=K({},me,{minHour:A(0),maxHour:A(23),minMinute:A(0),maxMinute:A(59),minSecond:A(0),maxSecond:A(59),minTime:{type:String,validator:ae},maxTime:{type:String,validator:ae},columnsType:{type:Array,default:()=>["hour","minute"]}});var Je=V({name:Ze,props:Xe,emits:["confirm","cancel","change","update:modelValue"],setup(e,{emit:t,slots:l}){const a=h(e.modelValue),s=h(),i=o=>{const _=o.split(":");return Ke.map((g,w)=>e.columnsType.includes(g)?_[w]:"00")},n=()=>{var o;return(o=s.value)==null?void 0:o.confirm()},d=()=>a.value,f=R(()=>{let{minHour:o,maxHour:_,minMinute:g,maxMinute:w,minSecond:$,maxSecond:F}=e;if(e.minTime||e.maxTime){const r={hour:0,minute:0,second:0};e.columnsType.forEach((u,p)=>{var C;r[u]=(C=a.value[p])!=null?C:0});const{hour:k,minute:S}=r;if(e.minTime){const[u,p,C]=i(e.minTime);o=u,g=+k<=+o?p:"00",$=+k<=+o&&+S<=+g?C:"00"}if(e.maxTime){const[u,p,C]=i(e.maxTime);_=u,w=+k>=+_?p:"59",F=+k>=+_&&+S>=+w?C:"59"}}return e.columnsType.map(r=>{const{filter:k,formatter:S}=e;switch(r){case"hour":return N(+o,+_,r,S,k,a.value);case"minute":return N(+g,+w,r,S,k,a.value);case"second":return N(+$,+F,r,S,k,a.value);default:return[]}})});U(a,o=>{I(o,e.modelValue)||t("update:modelValue",o)}),U(()=>e.modelValue,o=>{o=ve(o,f.value),I(o,a.value)||(a.value=o)},{immediate:!0});const b=(...o)=>t("change",...o),v=(...o)=>t("cancel",...o),x=(...o)=>t("confirm",...o);return ce({confirm:n,getSelectedTime:d}),()=>c(re,ne({ref:s,modelValue:a.value,"onUpdate:modelValue":o=>a.value=o,columns:f.value,onChange:b,onCancel:v,onConfirm:x},te(e,de)),l)}});const Qe=z(Je),ea=V({__name:"fieldInput",props:B(["placeholder"],{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const t=P(e,"modelValue"),l=e;return(a,s)=>{const i=E;return m(),D(i,{class:"askFont m-0! p-0!",modelValue:t.value,"onUpdate:modelValue":s[0]||(s[0]=n=>t.value=n),rows:"3",autosize:"",type:"textarea",maxlength:"100",placeholder:l.placeholder,"show-word-limit":""},null,8,["modelValue","placeholder"])}}}),aa={class:"flex h-4 justify-between items-center"},la={class:"askFont"},ta={class:"flex items-center"},oa=V({__name:"labelButton",props:B(["value","label"],{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const t=e,l=P(e,"modelValue");return(a,s)=>{const i=O;return m(),T("div",aa,[M("span",la,Y(t.label),1),M("div",ta,[(m(!0),T(L,null,j(t.value,(n,d)=>(m(),D(i,{plain:l.value!==n,onClick:f=>l.value=n,class:"ml-2! h-3! askFont",square:"",type:"success",key:d},{default:y(()=>[H(Y(n),1)]),_:2},1032,["plain","onClick"]))),128))])])}}}),na=V({__name:"labelSelect",props:B(["label"],{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const t=e,l=P(e,"modelValue");return(a,s)=>{const i=E;return m(),D(i,{class:"askFont p-0! pb-1! m-0!","is-link":"",readonly:"",label:t.label,modelValue:l.value,"onUpdate:modelValue":s[0]||(s[0]=n=>l.value=n),"input-align":"right"},null,8,["label","modelValue"])}}}),sa={class:"h-4 flex justify-between items-center"},ua={class:"askFont"},ia=V({__name:"labelSwitch",props:B(["label"],{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const t=e,l=P(e,"modelValue");return(a,s)=>{const i=Le;return m(),T("div",sa,[M("span",ua,Y(t.label),1),c(i,{modelValue:l.value,"onUpdate:modelValue":s[0]||(s[0]=n=>l.value=n),"active-color":"green","inactive-color":"#eee"},null,8,["modelValue"])])}}}),ra=se(ia,[["__scopeId","data-v-bb6c5620"]]),ca=V({__name:"labelTime",props:B(["label","value","rules"],{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const t=h(!1),l=e,a=P(e,"modelValue"),s=h([]),i=h([]),n=R(()=>s.value.join("-")+" "+i.value.join(":"));U(n,()=>{a.value=n.value});const d=h(),f=h(),b=()=>{t.value=!1},v=()=>{a.value="",t.value=!1};return(x,o)=>{const _=E,g=Ge,w=Qe,$=We,F=ue;return m(),T("div",null,[c(_,{class:"p-0! pb-1! m-0! askFont",rules:l.rules,modelValue:a.value,"onUpdate:modelValue":o[0]||(o[0]=r=>a.value=r),onClick:o[1]||(o[1]=r=>t.value=!0),label:l.label,"right-icon":"arrow","input-align":"right",readonly:""},null,8,["rules","modelValue","label"]),c(F,{show:t.value,"onUpdate:show":o[4]||(o[4]=r=>t.value=r),position:"bottom",style:{height:"70%"}},{default:y(()=>[c($,{class:"askFont",title:"预约日期",tabs:["选择日期","选择时间"],onConfirm:b,onCancel:v},{default:y(()=>[c(g,{class:"askFont",modelValue:s.value,"onUpdate:modelValue":o[2]||(o[2]=r=>s.value=r),"min-date":d.value,"max-date":f.value},null,8,["modelValue","min-date","max-date"]),c(w,{class:"askFont",modelValue:i.value,"onUpdate:modelValue":o[3]||(o[3]=r=>i.value=r)},null,8,["modelValue"])]),_:1})]),_:1},8,["show"])])}}}),ma={class:"h-10 flex flex-wrap"},da=V({__name:"muliButton",props:B(["value"],{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const t=e,l=P(e,"modelValue");return(a,s)=>{const i=O;return m(),T("div",ma,[(m(!0),T(L,null,j(t.value,n=>(m(),D(i,{plain:l.value!==n,onClick:d=>l.value=n,square:"",type:"primary",class:"askFont mr-1! h-3!",key:n},{default:y(()=>[H(Y(n),1)]),_:2},1032,["plain","onClick"]))),128))])}}}),fe=V({__name:"myButton",props:["value"],setup(e){const t=e;return(l,a)=>{const s=O;return m(),D(s,{class:"askFont",type:"primary",size:"large"},{default:y(()=>[H(Y(t.value),1)]),_:1})}}}),va={class:"flex"},fa={class:"ml-3"},pa=V({__name:"labelCheck",props:B(["label","value"],{modelValue:{type:Array,default:()=>[]},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const t=e,l=P(e,"modelValue"),a=R(()=>l.value?.join(",")),s=h(!1),i=h([]),n=b=>{i.value[b].toggle()},d=()=>{l.value=[],s.value=!1},f=()=>{s.value=!1};return(b,v)=>{const x=E,o=Ae,_=$e,g=oe,w=je,$=O,F=ue;return m(),T("div",null,[c(x,{onClick:v[0]||(v[0]=r=>s.value=!0),class:"askFont m-0! p-0!",label:t.label,placeholder:"",readonly:"",modelValue:a.value,"onUpdate:modelValue":v[1]||(v[1]=r=>a.value=r),"right-icon":"arrow"},null,8,["label","modelValue"]),c(F,{show:s.value,"onUpdate:show":v[4]||(v[4]=r=>s.value=r),position:"bottom",style:{height:"70%"},class:"py-3"},{default:y(()=>[c(w,{modelValue:l.value,"onUpdate:modelValue":v[3]||(v[3]=r=>l.value=r)},{default:y(()=>[c(g,{inset:""},{default:y(()=>[(m(!0),T(L,null,j(t.value,(r,k)=>(m(),D(_,{onClick:S=>n(k),key:k},{value:y(()=>[M("div",va,[c(o,{class:"askFont",name:r,ref_for:!0,ref:S=>i.value[k]=S,onClick:v[2]||(v[2]=be(()=>{},["stop"]))},{default:y(()=>[H(Y(r),1)]),_:2},1032,["name"])])]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1},8,["modelValue"]),M("div",fa,[c($,{onClick:d,class:"mr-1! askFont",text:"取消",type:"warning"}),c($,{onClick:f,text:"确定",class:"askFont",type:"primary"})])]),_:1},8,["show"])])}}}),_a=V({__name:"labelInput",props:B(["label","placeholder","rules"],{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const t=e,l=P(e,"modelValue");return(a,s)=>{const i=E;return m(),D(i,{class:"askFont p-0! m-0!",rules:t.rules,label:t.label,placeholder:t.placeholder,modelValue:l.value,"onUpdate:modelValue":s[0]||(s[0]=n=>l.value=n)},null,8,["rules","label","placeholder","modelValue"])}}}),ha=V({__name:"form",props:B(["formStructure"],{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const t=h(),l=e,a=P(e,"modelValue"),s={fieldInput:ea,labelButton:oa,labelSelect:na,labelSwitch:ra,labelTime:ca,muliButton:da,myButton:fe,labelCheck:pa,labelInput:_a};ge(()=>{});const i=()=>{};return(n,d)=>{const f=oe,b=Ne;return m(),D(b,{ref_key:"formRef",ref:t,onSubmit:i,class:""},{default:y(()=>[(m(!0),T(L,null,j(l.formStructure,(v,x)=>(m(),D(f,{inset:"",key:x,class:""},{default:y(()=>[(m(!0),T(L,null,j(v,(o,_)=>xe((m(),D(we(s[o.type]),{modelValue:a.value[o.key],"onUpdate:modelValue":g=>a.value[o.key]=g,value:o.value,label:o.label,key:_,placeholder:o.placeholder,rules:o.valida?o.rules:[]},null,8,["modelValue","onUpdate:modelValue","value","label","placeholder","rules"])),[[Ce,o.hidden==!1||o.hidden==null]])),128))]),_:2},1024))),128)),c(f,{inset:"",class:"p-1!"},{default:y(()=>[Se(n.$slots,"default",{formRef:t.value},void 0,!0)]),_:3})]),_:3},8,["onSubmit"])}}}),ka=se(ha,[["__scopeId","data-v-8458846a"]]);async function ya(e,t,l){return await Te(e,t,l)}const Va={class:"lg:text-[20px] text-[.25rem] flex w-full h-screen flex-col bg-gray-200"},ba={class:"flex-1 overflow-scroll flex flex-col"},ja=V({__name:"index",setup(e){const t=De(),l=h({studentName:t.studentName,askReason:"病假",disease:"",special:"",isLeave:"需要离校",isWeek:!1,leave:"设置时间",startTime:"",endTime:"",leaveSchoolTimes:[],isAtSchool:"非住校",scNumber:"",messageNotice:!1});U(()=>l.value.isWeek,()=>{l.value.isWeek?a.value?.[2]?.[1]?.hidden!=null&&a.value?.[2]?.[4]?.hidden!=null&&(a.value[2][1].hidden=!0,a.value[2][4].hidden=!1):a.value?.[2]?.[1]?.hidden!=null&&a.value?.[2]?.[4]?.hidden!=null&&(a.value[2][4].hidden=!0,a.value[2][1].hidden=!1)});const a=h([[{type:"labelSelect",label:"请假学生",key:"studentName",options:{option:{name:"闫果",value:"闫果"}}},{type:"labelButton",label:"请假原因",key:"askReason",value:["病假","事假"]},{hidden:!1,type:"muliButton",key:"disease",value:["感冒","发烧","腹泻","水痘","咳嗽","手足口","咽喉炎","其他疑似传染病","其他非传染病"]},{type:"fieldInput",key:"special",placeholder:"特殊情况说明(选填)"}],[{type:"labelButton",label:"离校需求",key:"isLeave",value:["需要离校","无需离校"]}],[{type:"labelSwitch",key:"isWeek",label:"按周期请假"},{hidden:!1,type:"labelButton",label:"是否立即请假",value:["设置时间","立即请假"],key:"leave"},{type:"labelTime",label:"开始日期",key:"startTime",valida:!0,rules:[{required:!0,message:"不能为空"}]},{type:"labelTime",label:"结束日期",key:"endTime",valida:!0,rules:[{required:!0,message:"不能为空"}]},{hidden:!0,type:"labelCheck",label:"请假频次",key:"leaveSchoolTimes",value:["星期一","星期二","星期三","星期四","星期五","星期六","星期日"]}],[{type:"labelButton",label:"是否住校",value:["住校","非住校"],key:"isAtSchool"},{hidden:!0,type:"labelInput",label:"宿舍编号",key:"scNumber",placeholder:"请输入宿舍号或名称",valida:!1,rules:[{pattern:/\d+/i,message:"请输入数字"}]}],[{type:"labelSwitch",label:"提交请假条后,给审批人发送短信通知",key:"messageNotice"}]]),s=i=>{i.formRef.validate().then(()=>{Me({message:"加载中...",forbidClick:!0,loadingType:"spinner",overlay:!0,className:["p-4","flex","justify-center","items-center","flex-col"],iconSize:"50px"}),ya("/api/askLeave","post",{...l.value}).then(n=>{console.log(n),Q(),Be("提交成功")}).catch(()=>{Q(),showToast("提交失败")})}).catch(n=>{console.log("验证失败",n)})};return U(()=>l.value.isAtSchool,()=>{l.value?.isAtSchool&&a.value?.[3]?.[1]?.hidden!=null&&(l.value.isAtSchool=="非住校"?(a.value[3][1].hidden=!0,a.value[3][1].valida=!1):(a.value[3][1].hidden=!1,a.value[3][1].valida=!0))}),U(()=>l.value.askReason,i=>{a.value[0]&&a.value[0][2]&&(i==="病假"?(a.value[0][2].hidden=!1,a.value[0][2].valida=!0):i==="事假"&&(a.value[0][2].hidden=!0,a.value[0][2].valida=!1))},{immediate:!0}),(i,n)=>(m(),T("div",Va,[c(pe,{title:"学生请假"}),M("main",ba,[n[1]||(n[1]=M("div",{class:"top askFont flex justify-between items-center h-4 p-1 bg-white"},[M("span",{class:""},"请假记录"),M("span",{class:"text-green-500"},"请假记录")],-1)),c(ka,{ref:"formRef","form-structure":a.value,modelValue:l.value,"onUpdate:modelValue":n[0]||(n[0]=d=>l.value=d)},{default:y(d=>[c(fe,{value:"提交请假条",onClick:f=>s(d)},null,8,["onClick"])]),_:1},8,["form-structure","modelValue"])])]))}});export{ja as default};
//# sourceMappingURL=index-BM2CZ0F9.js.map
